<ion-header [translucent]="true"> 
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="volver()">
        <ion-icon slot="start" name="arrow-back"></ion-icon>
        Volver
      </ion-button>
    </ion-buttons>
    <ion-title>
      游논 Asistentes: {{ experienciaEditando()?.nombre || 'Experiencia Desconocida' }}
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="ion-padding">
    @if (asistentesParaExperiencia().length > 0) {
      <!-- Lista de asistentes -->
      <ion-list>
        @for (asistente of asistentesParaExperiencia(); track asistente.id) {
          <ion-item>
            <ion-label>
              <h2>{{ asistentesParaExperiencia().indexOf(asistente) + 1 }}. {{ asistente.nombre }}</h2>
              <p>
                <ion-icon name="mail" class="ion-align-items-start"></ion-icon>
                {{ asistente.correo }}
              </p>
              <p>
                <ion-icon name="calendar" class="ion-align-items-start"></ion-icon>
                {{ formatFecha(asistente.fechaSolicitud) }}
              </p>
            </ion-label>

            <div slot="end" class="ion-text-end">
              <ion-badge [color]="getEstadoColor(asistente.estado)" class="ion-margin-bottom">
                {{ getEstadoTexto(asistente.estado) }}
              </ion-badge>

              <div class="ion-margin-top">
                @if (asistente.estado !== 'aprobada') {
                  <ion-button
                    size="small"
                    color="success"
                    fill="clear"
                    (click)="confirmarAprobar(asistente)">
                    <ion-icon name="checkmark" slot="icon-only"></ion-icon>
                  </ion-button>
                }

                @if (asistente.estado !== 'rechazada') {
                  <ion-button
                    size="small"
                    color="danger"
                    fill="clear"
                    (click)="confirmarRechazar(asistente)">
                    <ion-icon name="close" slot="icon-only"></ion-icon>
                  </ion-button>
                }
              </div>
            </div>
          </ion-item>
        }
      </ion-list>

      <!-- Resumen de Asistencia -->
      <ion-card class="ion-margin-top">
        <ion-card-header>
          <ion-card-title>Resumen</ion-card-title>
        </ion-card-header>

        <ion-card-content>
          <ion-grid>
            <ion-row>
              <ion-col size="12" size-md="4">
                <div class="stat-card">
                  <div class="stat-number text-primary">{{ asistentesParaExperiencia().length }}</div>
                  <div class="stat-label">Total Registrados</div>
                </div>
              </ion-col>

              @if (experienciaEditando()) {
                <ion-col size="12" size-md="4">
                  <div class="stat-card">
                    <div class="stat-number text-success">{{ getAsistentesAprobados(experienciaEditando()!.id).length }}</div>
                    <div class="stat-label">Asistentes Aprobados</div>
                  </div>
                </ion-col>

                <ion-col size="12" size-md="4">
                  <div class="stat-card">
                    <div class="stat-number text-warning">{{ getAsistentesPendientes(experienciaEditando()!.id).length }}</div>
                    <div class="stat-label">Pendientes</div>
                  </div>
                </ion-col>
              }
            </ion-row>
          </ion-grid>
        </ion-card-content>
      </ion-card>
    }
    @else {
      <ion-card>
        <ion-card-content class="ion-text-center empty-state">
          <h2>游땺 No hay asistentes registrados</h2>
          <p class="ion-margin-top">
            No hay asistentes registrados para esta experiencia.
          </p>
        </ion-card-content>
      </ion-card>
    }
  </div>

  <!-- Action Sheet para acciones r치pidas -->
  <ion-action-sheet
    [isOpen]="isActionSheetOpen()"
    header="Acciones para {{ selectedAsistente()?.nombre }}"
    [buttons]="actionSheetButtons"
    (didDismiss)="isActionSheetOpen.set(false)">
  </ion-action-sheet>

  <!-- Alert para confirmar aprobaci칩n -->
  <ion-alert
    [isOpen]="isAprobarAlertOpen()"
    header="Confirmar Aprobaci칩n"
    [message]="'쮼st치s seguro de que quieres aprobar a ' + selectedAsistente()?.nombre + '?'"
    [buttons]="alertButtons"
    (didDismiss)="isAprobarAlertOpen.set(false)">
  </ion-alert>

  <!-- Alert para confirmar rechazo -->
  <ion-alert
    [isOpen]="isRechazarAlertOpen()"
    header="Confirmar Rechazo"
    [message]="'쮼st치s seguro de que quieres rechazar a ' + selectedAsistente()?.nombre + '?'"
    [buttons]="alertButtons"
    (didDismiss)="isRechazarAlertOpen.set(false)">
  </ion-alert>
</ion-content>
