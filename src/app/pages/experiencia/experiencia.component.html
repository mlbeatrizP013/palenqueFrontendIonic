<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>ğŸ¯ GestiÃ³n de Experiencias</ion-title>
    @if (currentView() === 'list') {
      <ion-button slot="end" (click)="navegarAFormulario()">
        â• Nueva Experiencia
      </ion-button>
    }
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  @if (currentView() === 'list') {
    <div class="ion-padding">
      @if (experiencias().length > 0) {
        <ion-grid>
          <ion-row>
            @for (experiencia of experiencias(); track experiencia.id) {
              <ion-col size="12" size-md="6" size-lg="4">
                <ion-card>
                  <ion-card-header>
                    <ion-card-title>ğŸ¸ {{ experiencia.nombre }}</ion-card-title>
                  </ion-card-header>
                  
                  <ion-card-content>
                    <ion-item lines="none">
                      <ion-icon name="calendar" slot="start"></ion-icon>
                      <ion-label>
                        <p>ğŸ“… {{ experiencia.fecha }}</p>
                        <p>â° {{ experiencia.hora }}</p>
                      </ion-label>
                    </ion-item>

                    <p class="descripcion">{{ experiencia.descripcion }}</p>

                    <ion-grid class="stats-grid">
                      <ion-row>
                        <ion-col>
                          <div class="stat-item">
                            <strong class="stat-number text-pink">
                              {{ getAsistentesPorExperiencia(experiencia.id).length }}
                            </strong>
                            <span class="stat-label">Total Asistentes</span>
                          </div>
                        </ion-col>
                        <ion-col>
                          <div class="stat-item">
                            <strong class="stat-number text-green">
                              {{ getAsistentesAprobados(experiencia.id).length }}
                            </strong>
                            <span class="stat-label">Aprobados</span>
                          </div>
                        </ion-col>
                      </ion-row>
                    </ion-grid>

                    <ion-grid class="actions-grid">
                      <ion-row>
                        <ion-col>
                          <ion-button 
                            expand="block" 
                            color="warning" 
                            size="small"
                            (click)="navegarAEdicion(experiencia.id)">
                            âœï¸ Editar
                          </ion-button>
                        </ion-col>
                        <ion-col>
                          <ion-button 
                            expand="block" 
                            color="primary" 
                            size="small"
                            (click)="verAsistentesDeExperiencia(experiencia.id)">
                            ğŸ‘¥ Asistentes
                          </ion-button>
                        </ion-col>
                        <ion-col>
                          <ion-button 
                            expand="block" 
                            color="danger" 
                            size="small"
                            (click)="confirmarEliminar(experiencia.id)">
                            ğŸ—‘ï¸ Eliminar
                          </ion-button>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-card-content>
                </ion-card>
              </ion-col>
            }
          </ion-row>
        </ion-grid>
      } @else {
        <div class="empty-state">
          <ion-card>
            <ion-card-content class="ion-text-center">
              <h2>ğŸ˜´ No hay experiencias programadas</h2>
              <p class="ion-margin-top">Comienza creando tu primera experiencia</p>
              <ion-button 
                class="ion-margin-top"
                (click)="navegarAFormulario()">
                â• Crear Primera Experiencia
              </ion-button>
            </ion-card-content>
          </ion-card>
        </div>
      }
    </div>
  }

  @if (currentView() === 'form') {
    <div class="ion-padding">
      <ion-card>
        <ion-card-header>
          <ion-card-title>
            {{ isEditMode() ? 'âœï¸ Editar Experiencia' : 'â• Agregar Nueva Experiencia' }}
          </ion-card-title>
        </ion-card-header>

        <ion-card-content>
          <form [formGroup]="experienciaForm">
            <!-- Nombre -->
            <ion-item>
              <ion-label position="stacked">ğŸ·ï¸ Nombre *</ion-label>
              <ion-input 
                formControlName="nombre" 
                placeholder="Ej: Cata de Tequila Ultra Premium"
                type="text">
              </ion-input>
            </ion-item>
            @if (experienciaForm.get('nombre')?.invalid && experienciaForm.get('nombre')?.touched) {
              <ion-text color="danger" class="ion-padding-start">
                <small>Nombre requerido (mÃ­n. 3 caracteres)</small>
              </ion-text>
            }

            <!-- Fecha y Hora -->
            <ion-grid>
              <ion-row>
                <ion-col size="12" size-md="6">
                  <ion-item>
                    <ion-label position="stacked">ğŸ“… Fecha *</ion-label>
                    <ion-input 
                      formControlName="fecha" 
                      type="date">
                    </ion-input>
                  </ion-item>
                </ion-col>
                <ion-col size="12" size-md="6">
                  <ion-item>
                    <ion-label position="stacked">â° Hora *</ion-label>
                    <ion-input 
                      formControlName="hora" 
                      type="time">
                    </ion-input>
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-grid>

            <!-- DescripciÃ³n -->
            <ion-item>
              <ion-label position="stacked">ğŸ“ DescripciÃ³n</ion-label>
              <ion-textarea 
                formControlName="descripcion" 
                rows="4" 
                placeholder="Detalles de la experiencia, lugar, costo, etc.">
              </ion-textarea>
            </ion-item>

            <!-- Acciones del Formulario -->
            <ion-grid class="ion-margin-top">
              <ion-row>
                <ion-col>
                  <ion-button 
                    expand="block" 
                    color="medium" 
                    (click)="navegarALista()">
                    â†©ï¸ Cancelar
                  </ion-button>
                </ion-col>
                <ion-col>
                  <ion-button 
                    expand="block" 
                    color="primary" 
                    (click)="guardar()"
                    [disabled]="experienciaForm.invalid">
                    ğŸ’¾ {{ isEditMode() ? 'Actualizar' : 'Guardar' }}
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-grid>
          </form>
        </ion-card-content>
      </ion-card>
    </div>
  }

  <!-- Action Sheet para acciones -->
  <ion-action-sheet
    [isOpen]="isActionSheetOpen()"
    header="Acciones"
    [buttons]="actionSheetButtons"
    (didDismiss)="cerrarAcciones()">
  </ion-action-sheet>

  <!-- Alert para confirmar eliminaciÃ³n -->
  <ion-alert
    [isOpen]="isDeleteAlertOpen()"
    header="Confirmar EliminaciÃ³n"
    message="Â¿EstÃ¡s seguro de que quieres eliminar esta experiencia?"
    [buttons]="alertButtons"
    (didDismiss)="isDeleteAlertOpen.set(false)">
  </ion-alert>
</ion-content>